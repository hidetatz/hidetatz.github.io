<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>2025年1月22日 名前をつける必要がないものに名前をつけない</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="author" content="Hidetatz Yaginuma">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">

  <style>
    body {
      box-sizing: border-box;
      min-width: 200px;
      max-width: 980px;
      margin: 0 auto;
      padding: 45px;
    }
  </style>

  <link href="/markdown.css" rel="stylesheet"></link>
  <link href="/syntax.css" rel="stylesheet"></link>
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>
</head>
<body class="markdown-body">
<p><a href="/diary" rel="nofollow">&lt;- 日記</a></p>
<h1>2025年1月22日 名前をつける必要がないものに名前をつけない</h1>
<p>プログラミングとは何かというと、現実世界の出来事を、計算機が実行可能な命令シーケンスにエンコードすることだ。なので、プログラムは現実世界の抽象表現そのものと言えるし、プログラミングとはその抽象化のプロセスそのものと言える。</p>
<p>抽象化とは、物事の着目したい点を抜き出して、モデルとして定義することだ。定義するためには呼び方が必要で、プログラムにおいてはそれは変数名、関数名、クラス名、モジュール名、ネームスペース、パッケージなどのことである。</p>
<p>いつか書いたような気がするが、抽象化の目的は効率のため、もっというと時短のためだと考えている。抽象化しないとコミュニケーションは煩雑で仕方ないのだということはなんとなくわかると思う。</p>
<p>プログラミングする上で私が重要だと考えているのが、この抽象化を適切に行うことだ。</p>
<p>抽象化を適切に行うというのは、抽象化の度合いを適切なものに設定することだ。抽象化の度合いが低いプログラムというのは、単一のパッケージの単一の関数にすべてがハードコードされ、マジックナンバーがいっぱいあるような状態。抽象化の度合いが高いプログラムは、責務が分割され、中身を知らなくても概念さえ知っていれば正しく使えるような状態。</p>
<p>これはどちらがいいというものではなく、単に抽象化の度合いが異なるだけだ。自分専用の書き捨てのプログラムと、100人のプログラマで10年間保守しなければいけないプログラムでは、どのくらいの度合いで抽象化するべきかが全く異なる。その度合いを見誤ると、超変更に弱いコードになったり、逆にオーバーエンジニアリングになったりする。</p>
<p>この、抽象化の度合いをどう適切にするかの方法論はあまりいいものがなくて、熟練したプログラマの勘と経験で決まってくることが多いのだけど、一般論としてはどちらかというとオーバーエンジニアリングを避けるほうが重要とされることが多いと思う。</p>
<p>逆に、どう抽象化するか？という知識は割とコモディティ化している。それはリーダブルコードとか、デザインパターンとかそういうやつだ。でも抽象化の度合いが適切なのか？を知る方法はよくわからない。</p>
<p>よくわからない中で、これが大事なんじゃないかなと思っているのは、「名前をつける必要がないものに名前をつけないこと」だ。</p>
<p>名前をつけるという行為は抽象化そのものだ。名前がないと、それがどんなものかを知るためにはそのものを深く知ろうとしないとわからない。しかし名前をつけることで、名前で認識できるようになる。名前をつけることで、その中身をぼんやりとしか認識できなくなる代わりに、名前という共通言語を持つことになるので協働のスピードを上げることができる。</p>
<p>なので、名前をつけすぎるとそれは「抽象化のやりすぎ」になり、それはオーバーエンジニアリングそのものだ。</p>
<p>例えば、マジックナンバーを変数に出しましょうとか、メッセージを定数に出しましょうとかそういうプラクティスがある。これは、マジックナンバーやメッセージの文字列に名前をつけて抽象化しましょう、という話だ。でも本当にそれは必要なのか？</p>
<p>抽象化は本来けっこう難しい。本当に抽象化の対象をよく理解する必要がある。さらに、仮に理解が正しかったとしても、間違った抽象化をしてしまうこともある。プログラミングでは、間違った理解、間違った抽象化、さらにそもそも間違ったプログラム、そしてシステム要件の変化によって基本的にコードベースはカオスに向かって緩やかに近づいていく。</p>
<p>プログラミングにおいて名前をつけるということは、その名前以上のことを知らなくても良いですということを、書き手以外のプログラマに伝えることを意味する。例えばある処理を関数 (サブルーチンのこと) に切り出すとき、切り出された瞬間からその処理は関数名で呼ばれることになり、関数名でこの世界に認識される。</p>
<p>そもそもなぜプログラミングにおいて抽象化が重要かというと、それはプログラムと抽象化の相性の良さに理由がある。プログラム、もっといえばソフトウェアは、一度書いたものを書き直したり、すこしずつ改造したりすることができるという、とてつもなく大きいメリットがある。ハードウェアという一度製造したら基本的には変えられないものと違って、これはあまりにもコスト削減効果が大きい。FPGAとか、エミュレータとか、電子書籍とか、この特性を活かしたものはたくさんある。
なので、必然的にプログラムは、将来に渡って変更され続けることになる。この「なにかを変更する」という行為において、抽象化は絶大な力を持つ。それは、「抽象化すると、具体的な中身が変わっていても、認識を改めなくてよい」という抽象化が持つ特性からなるものだ。機械がモデルチェンジしても、今までと同じボタンを押せば起動するとか、中の人間が変わっても、同じ部署に仕事を依頼すればいいとか、そういうことがダイレクトに時短につながる。プログラムでも、モジュールの実装が知らない間に変わっていても、同じ名前と同じインタフェースで呼び出すことができる。これが「変化し続ける」プログラムと抜群に相性が良い。</p>
<p>しかし、逆に言うとプログラムの中でなにか名前をつけるとき、それは「中身が変わるのかもしれない」ということをプログラムの読み手に伝えていることになる。</p>
<p>名前のついていないプログラムは、中身は決して変わらない。それは、名前がついていないからだ。例えばReadしてWriteするプログラムを書いたとき、それに名前をつけなければ、そのプログラムはあなただけのものだ。名前をつけると、それは「プログラムを書くみんなのもの」になる。これは本質的にグローバル変数と同じなのだ。</p>
<p>なので、プログラムは基本的に、名前のついている部分から壊れていく。みんなのものだからだ。名前がついているということは、中身を変えていいということなので、壊れるチャンスがものすごく増えてしまうのだ。名前をつけていない部分は決して壊れない。あるいは、その名前が指すものが小さければ小さいほど、壊れるチャンスも少ない。小さいものを壊すのは難しいのだ。</p>
<p>この話がわかっていると、よく何も考えていないやつが設定したリンターとかが、「この関数は大きすぎるので分割してください」とか「循環的複雑度が閾値を超えているので直してください」などと言い出すときがあるが、これらが以下に的外れかがわかるだろう。プログラムの抽象化レベルを適切に保つためには、不用意に名前をつけないことがすごく重要で、これがオーバーエンジニアリングを避けることに直結する。</p>

<script src="/highlight.pack.js"></script>
<script>hljs.highlightAll();</script>
</body>
</html>